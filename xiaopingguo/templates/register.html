<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, width=device-width,target-densitydpi=device-dpi"/>
	    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
		<title>æŠ¢ä¸€ä¸ªå¹³å®‰æœ,é€ä¸ªæœ€å¿ƒçˆ±çš„Ta</title>
		<style>
			body{
				background-image: url("/static/image/bg-ch.jpg");
				background-repeat: no-repeat;
				background-size: cover;
			}
			.BOX{
				width: 92%;
				margin: auto;
				padding-top: 40px;
				padding-left: 10px;
				padding-right: 10px;
				/*padding-bottom: 20px;*/
				background-color: rgba(0,0,0,0.2);
				border-radius: 5px;
			}
			.group{
				height: 45px;
				margin-top: 5px;
				position: relative;
			}
			span{
				color: white;
				font-size: 20px;
				height: 44px;
				line-height: 44px;
			}
			.group input{
				position: absolute;
				left: 80px;
				height: 40px;
				top: 1px;
				width: calc(100% - 100px);
				font-size: 16px;
				border: 1px solid #c2c2c2;
				outline: none;
			}
			.group-area textarea{
				height: 60px;
				width: calc(100% - 10px);
				font-size: 16px;
				border: 1px solid #c2c2c2;
				outline: none;
			}
			.button{
				font-size: 24px;
				color: white;
				background-color: #f6aa08;
				text-align: center;
				height: 44px;
				line-height: 44px;
				width: 200px;
				margin: auto;
				border-radius: 5px;
				margin-top: 10px;
			}
		</style>
	</head>
	<body>
		<div class="BOX">
			<p class="group">
				<span>å§“&nbsp;&nbsp;&nbsp;&nbsp;å:</span>
				<input id="username" type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å(å¿…å¡«)" />
			</p>
			<p class="group">
				<span>æ‰‹æœºå·:</span>
				<input id="telphone" type="tel" placeholder="è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·(å¿…å¡«)" maxlength="11" />
			</p>
			<p class="group-area">
				<span>é‚®å¯„åœ°å€:(ä»…é™æ­¦æ±‰å¸‚åŸåŒº)</span>
				<br />
				<textarea id="address" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®å¯„åœ°å€(å¿…å¡«)"></textarea>
			</p>
			<p class="group">
				<span>å¤‡&nbsp;&nbsp;&nbsp;&nbsp;æ³¨:</span>
				<input id="beizhu" type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„å¤‡æ³¨ä¿¡æ¯" />
			</p>
			<br />
		</div>
		<div class="button" onclick="sendData()">æäº¤</div>
	</body>
	<script>
		var username = document.getElementById('username');
		var telphone = document.getElementById("telphone");
		var address = document.getElementById('address');
		var beizhu = document.getElementById('beizhu');
		// è¯»å–cookieé‡Œé¢çš„æ•°æ®
		function getCookie(name)
		{
			var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
			if(arr=document.cookie.match(reg))
				return unescape(arr[2]);
			else
				return 0;
		}
		// æäº¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
		function sendData(){
			// è·å–ç”¨æˆ·åˆ†æ•°
{#			var user_score = getCookie("user_score");#}
{#			alert('user_score = ' + user_score);#}
            var user_score = localStorage.getItem('user_score');
			console.log(user_score);
			var jsonData = [
				{
					"name": username.value,
					"phone": telphone.value,
					"address": address.value,
					"add_more": beizhu.value,
					"surplus_apple": '9999',
					"score": user_score
				}
			]
//			var res = '300,Sorry!å¥–å“å‘æ”¾å®Œæ¯•ğŸ˜‚,900';
			if (checkPhone()) {
				$.ajax({
					url: "{% url 'user_info' %}",
					data: JSON.stringify(jsonData),
					async:true,    //æˆ–false,æ˜¯å¦å¼‚æ­¥
					dataType: 'text', //æœåŠ¡å™¨è¿”å›jsonæ ¼å¼æ•°æ®
					type: 'post', //HTTPè¯·æ±‚ç±»å‹
					timeout: 10000, //è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º10ç§’ï¼›
					beforeSend: function() {},
					success: function(res) {
{#						alert('æœåŠ¡å™¨è¿”å› = ' + res);#}
						var resArr = res.split(',');
						if (resArr[0] == '100') { // é¢†å–æˆåŠŸ
							alert("æ­å–œä½ é¢†å–æˆåŠŸ!");
							// è¿”å›é¦–é¡µ
							window.location.href = {% url 'home' %};
						}else if(resArr[0] == '200'){ // è¯¥æ‰‹æœºå·å·²ç»é¢†å–è¿‡
							alert(resArr[1]);
							// è¿”å›é¦–é¡µ
							window.location.href = {% url 'home' %};
						}else if(resArr[0] == '300'){ // Sorry!å¥–å“å‘æ”¾å®Œæ¯•
							alert(resArr[1]);
							// è¿”å›é¦–é¡µ
							window.location.href = {% url 'home' %};
						}
					},
					error: function(xhr, type, errorThrown) {
						alert('ç½‘ç»œè¿æ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
					}
				});
			}
		}
		// æ•°æ®æ•ˆéªŒ
		function checkPhone(){
			var re = /^1\d{10}$/;
			// å§“å
			if (username.value.trim().length === 0) {
				alert("è¯·è¾“å…¥å§“å") /*å§“åä¸èƒ½ä¸ºç©º*/
				return false;
			}else if (telphone.value.length < 11 || (!re.test(telphone.value))) { // æ‰‹æœºå·æ ¼å¼
				alert("æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®") /*æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®*/
				return false;
			}else if (address.value.trim().length === 0) { // é‚®å¯„åœ°å€
				alert("è¯·å¡«å†™é‚®å¯„åœ°å€") /*é‚®å¯„åœ°å€ä¸èƒ½ä¸ºç©º*/
				return false;
			}else{
				return true;
			}
		}
	</script>
</html>
